<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BIOL550 Lab 3 Report</title>
  <style>
    body { font-family: "Times New Roman", Times, serif; font-size: 12pt; margin: 16px; line-height: 1.15; color: #111; }
    h1, h2, h3 { margin: 0 0 8px 0; }
    h1 { text-align: center; }
    .subtitle { text-align: center; font-size: 11pt; margin: 0 0 12px 0; }
    h2 { margin-top: 16px; }
    p { text-align: justify; }
    ul { margin: 6px 0 10px 20px; }
    pre { background: #f5f5f5; padding: 10px; border: none; box-shadow: none; outline: none; overflow-x: auto; font-size: 11px; }
    code { font-family: Menlo, Consolas, monospace; font-size: 10px; }
    .note { font-style: italic; }
    img { max-width: 60%; height: auto; display: block; margin: 8px auto; }
    .figure-title { text-align: center; font-size: 11pt; margin: 4px 0 10px 0; }
    .img-row { display: flex; gap: 16px; align-items: flex-start; justify-content: center; margin: 8px 0 10px 0; }
    .img-col { flex: 0 1 420px; }
    .img-row img { max-width: 100%; margin: 0 auto; }
    .img-single { max-width: 360px; margin: 8px auto 10px auto; }
    .img-single img { max-width: 100%; margin: 0 auto; }
    @media print {
      body { margin: 0.75in; }
      pre { white-space: pre-wrap; word-break: break-word; border: none !important; box-shadow: none !important; outline: none !important; }
      .img-row { break-inside: avoid; }
    }
  </style>
</head>
<body>
  <h1>Trapnell data set - differential expression (cuffdiff)</h1>
  <div class="subtitle">BIOL550 - Lab 3 Report</div>

  <h2>What I Accomplished Since The Previous Report</h2>
  <p>Since the previous report, I completed the Trapnell differential expression step using <code>cuffdiff</code> on the XS-tagged STAR alignments and exported the output directory locally. I then performed a small downstream summary by filtering <code>gene_exp.diff</code> for significant genes (<code>q_value &lt;= 0.05</code>) and generated a few sanity-check figures. Finally, I packaged the <code>cuffdiff</code> output directory for myCourses submission as <code>cuffdiff_results.zip</code>.</p>

  <h3>Results summary</h3>
  <p>Summary file written by the notebook: <code>lab3/notes/results_summary.txt</code></p>
  <pre><code>Lab 3: Cuffdiff gene-level DE summary
OK tests: 8289
Significant genes (q&lt;=0.05): 265
Top up (by log2FC): Fatp, crc, scf, CTPsyn, Df31
Top down (by log2FC): Nep2, RpS19b, Amy-d, CG6847, Aplip1</code></pre>

  <h2>Methods I Used (Commands Used With Parameters)</h2>
  <p>This section focuses on the analysis steps and the parameters that affect results (not basic shell navigation or file transfer).</p>
  <p>Submission artifact: <code>lab3/cuffdiff_results.zip</code>, containing only <code>cuffdiff_classref_v2_xs/</code>.</p>

  <h3>Differential expression (cuffdiff)</h3>
  <p>Runs <code>cuffdiff</code> on the XS-tagged STAR alignments (3 replicates per condition) using the BDGP6.84 annotation and the matching reference FASTA. The output directory produced on the server is <code>~/BIOL550/Lab1/cuffdiff_classref_v2_xs/</code>.</p>
  <pre><code>/usr/local/bin/cufflinks/cuffdiff \
  -o /home/pzg8794/BIOL550/Lab1/cuffdiff_classref_v2_xs \
  -p 4 \
  -L C1,C2 \
  -b /home/pzg8794/refs/classref_bdgp6_84_ids_v2.fa \
  "/home/pzg8794/BIOL550/Lab1/Trapnell_Data/Trapnell Data/Drosophila reference/Drosophila_melanogaster.BDGP6.84.gtf" \
  /home/pzg8794/BIOL550/Lab1/star_align_classref_v2_all_xs/GSM794483_C1_R1/Aligned.sortedByCoord.out.bam,/home/pzg8794/BIOL550/Lab1/star_align_classref_v2_all_xs/GSM794484_C1_R2/Aligned.sortedByCoord.out.bam,/home/pzg8794/BIOL550/Lab1/star_align_classref_v2_all_xs/GSM794485_C1_R3/Aligned.sortedByCoord.out.bam \
  /home/pzg8794/BIOL550/Lab1/star_align_classref_v2_all_xs/GSM794486_C2_R1/Aligned.sortedByCoord.out.bam,/home/pzg8794/BIOL550/Lab1/star_align_classref_v2_all_xs/GSM794487_C2_R2/Aligned.sortedByCoord.out.bam,/home/pzg8794/BIOL550/Lab1/star_align_classref_v2_all_xs/GSM794488_C2_R3/Aligned.sortedByCoord.out.bam</code></pre>
  <p class="note">Note: The upstream STAR BAMs were generated with <code>--outSAMstrandField intronMotif</code> to ensure spliced alignments include <code>XS</code> tags (required by <code>cuffdiff</code>).</p>

  <h3>Downstream summary (local)</h3>
  <p>After exporting the <code>cuffdiff</code> output directory locally, I summarized gene-level differential expression from <code>gene_exp.diff</code> using an FDR cutoff and generated a few sanity-check plots. The key choices were:</p>
  <ul>
    <li>Filter to <code>status == "OK"</code> rows (valid tests)</li>
    <li>Define significance as <code>q_value &lt;= 0.05</code></li>
    <li>Visual checks: volcano plot (log2FC vs -log10(p)), top-gene bar chart, and replicate PCA from <code>genes.read_group_tracking</code></li>
  </ul>

  <div class="img-row">
    <div class="img-col">
      <h3>Volcano plot</h3>
      <p>Generates a volcano plot from <code>gene_exp.diff</code> and saves it to <code>lab3/figures/volcano_gene_exp_python.png</code>.</p>
      <img src="figures/volcano_gene_exp_python.png" alt="Volcano plot (gene_exp.diff)" />
      <div class="figure-title">Volcano plot: <code>gene_exp.diff</code></div>
    </div>
    <div class="img-col">
      <h3>Top 20 DE genes bar chart</h3>
      <p>Builds a simple bar chart of the top up/down DE genes (by log2FC) and saves it to <code>lab3/figures/top20_bar_log2fc.png</code>.</p>
      <img src="figures/top20_bar_log2fc.png" alt="Top 20 DE genes bar chart" />
      <div class="figure-title">Top DE genes (by log2FC)</div>
    </div>
  </div>

  <h3>PCA of samples (replicates)</h3>
  <p>Uses <code>genes.read_group_tracking</code> to build a replicate expression matrix and runs PCA (via SVD) to sanity-check sample separation.</p>
  <p class="note">Sanity-check only: the PCA figure was generated during analysis, but omitted from this report to keep the results section compact.</p>

  <h2>Problems I Encountered</h2>
  <p>No additional issues occurred during the local downstream summarization once the <code>cuffdiff</code> outputs were exported. The key prerequisite for this step was ensuring the upstream STAR alignments were produced with XS tags so that <code>cuffdiff</code> could run successfully on spliced reads.</p>

  <h2>Goals For The Coming Week</h2>
  <p>Next week, I will submit the <code>cuffdiff</code> results early for instructor feedback and address any issues with the output interpretation or formatting. I will also continue progressing from the Trapnell workflow into additional downstream interpretation (e.g., reviewing top DE genes and confirming the biological directionality matches expectations). Finally, I will keep moving forward on the group project dataset analysis and document weekly progress in the same report format.</p>
</body>
</html>
